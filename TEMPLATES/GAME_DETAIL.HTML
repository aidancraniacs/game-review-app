{% extends "BASE.HTML" %}
{% block content %}

<section class="game-detail">

  <a
    href="{{ url_for('games') }}"
    class="btn ghost small back-btn"
    data-pjax
  >
    â† Back to catalogue
  </a>

  <div class="game-detail-header">
    <div class="game-cover">
      <img
        src="{{ url_for('static', filename=game.cover_url) if game.cover_url else url_for('static', filename='cover-placeholder.png') }}"
        alt="{{ game.title }} cover"
      >
    </div>

    <div class="game-meta">
      <h1>{{ game.title }}</h1>

      <p class="rating big">
        {% if avg_rating %}
          â˜… {{ avg_rating }}/5
          <span class="muted">Â· {{ review_count }} reviews</span>
        {% else %}
          <span class="muted">No ratings yet</span>
        {% endif %}
      </p>

      {% if game.description %}
        <p class="description">{{ game.description }}</p>
      {% endif %}
    </div>
  </div>

  <section class="reviews-section">
    <h2>Player reviews</h2>

    {% if reviews %}
      <div class="review-list">
        {% for review in reviews %}
          {% set likes = review.likes | selectattr("value", "equalto", 1) | list | length %}
          {% set dislikes = review.likes | selectattr("value", "equalto", -1) | list | length %}

          <article class="review-card review-item">

            <header class="review-header">
              <strong>{{ review.user.username }}</strong>
              <span class="stars">â˜… {{ review.rating }}/5</span>
            </header>

            {% if review.title %}
              <h4 class="review-title">{{ review.title }}</h4>
            {% endif %}

            {% if review.content %}
              <p class="review-content">{{ review.content }}</p>
            {% endif %}

            <p class="muted small">
              {{ review.created_at.strftime("%b %d, %Y") }}
            </p>

            <div class="review-actions">

              <form method="post" action="{{ url_for('react_review', review_id=review.id) }}">
                <input type="hidden" name="value" value="1">
                <button class="btn ghost small" type="submit">
                  ğŸ‘ {{ likes }}
                </button>
              </form>

              <form method="post" action="{{ url_for('react_review', review_id=review.id) }}">
                <input type="hidden" name="value" value="-1">
                <button class="btn ghost small" type="submit">
                  ğŸ‘ {{ dislikes }}
                </button>
              </form>

            </div>

          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="muted">No reviews yet. Be the first to review this game.</p>
    {% endif %}

    {% if reviews|length > 3 %}
      <div class="load-more-wrap">
        <button class="btn ghost small" id="load-more-reviews">
          Load more reviews
        </button>
      </div>
    {% endif %}

  </section>

</section>

{% endblock %}